<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- Firebase Hosting auto init (compat) for Firestore without bundling config -->
    <!-- Load Firebase Hosting init only in production hosting (avoid 404s in Vite dev) -->
    <script>
      ;(function () {
        var host = location.hostname
        var onHosting = /web\.app$/.test(host) || /firebaseapp\.com$/.test(host)
        if (!onHosting) return // skip in local dev
        function load(src) {
          return new Promise(function (resolve, reject) {
            var s = document.createElement('script')
            s.src = src
            s.onload = resolve
            s.onerror = reject
            document.head.appendChild(s)
          })
        }
        // Ensure init.js runs AFTER SDKs are available
        load('/__/firebase/10.12.2/firebase-app-compat.js')
          .then(function () {
            return load('/__/firebase/10.12.2/firebase-firestore-compat.js')
          })
          .then(function () {
            return load('/__/firebase/init.js')
          })
          .catch(function (e) {
            console.error('Firebase SDK load failed', e)
          })
      })()
    </script>
    <link rel="icon" type="image/png" href="/icon-512.png" />
    <link rel="manifest" href="/manifest.json" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Kaden Adventures" />
    <meta name="theme-color" content="#667eea" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#0a0e27" media="(prefers-color-scheme: dark)" />
    <meta
      name="description"
      content="Kaden & Adelynn Space Adventures - An epic space shooter game with 100+ features!"
    />
    <meta name="keywords" content="space shooter, arcade game, kaden, adelynn, space adventure" />
    <meta name="application-name" content="Kaden Adventures" />
    <link rel="apple-touch-icon" href="/icon-512.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="/icon-512.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="/icon-512.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png" />
    <title>Kaden & Adelynn Space Adventures</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
    <script>
      // Register Service Worker for PWA (disabled on localhost to avoid dev caching issues)
      ;(function () {
        const isLocal = /^(localhost|127\.|0:0:0:0:0:0:0:1|\[::1\])$/.test(location.hostname)
        if ('serviceWorker' in navigator && !isLocal) {
          window.addEventListener('load', () => {
            navigator.serviceWorker
              .register('/sw.js')
              .then((registration) => {
                console.log('SW registered: ', registration)
              })
              .catch((registrationError) => {
                console.log('SW registration failed: ', registrationError)
              })
          })
        } else if (isLocal && navigator.serviceWorker) {
          // Ensure no old SW controls the page during local dev
          navigator.serviceWorker.getRegistrations().then((rs) => rs.forEach((r) => r.unregister()))
        }
      })()
    </script>
    <script>
      // iOS PWA pull-down-to-refresh: reload when user pulls from top
      ;(function () {
        const isStandalone =
          window.navigator.standalone || window.matchMedia('(display-mode: standalone)').matches
        if (!isStandalone) return
        let startY = 0
        let pulling = false
        window.addEventListener(
          'touchstart',
          (e) => {
            if (document.scrollingElement && document.scrollingElement.scrollTop === 0) {
              startY = e.touches[0].clientY
              pulling = true
            } else {
              pulling = false
            }
          },
          { passive: true }
        )
        window.addEventListener(
          'touchmove',
          (e) => {
            if (!pulling) return
            const dy = e.touches[0].clientY - startY
            if (dy > 80) {
              pulling = false
              // Force reload to pick up latest assets
              location.reload()
            }
          },
          { passive: true }
        )
        window.addEventListener(
          'touchend',
          () => {
            pulling = false
          },
          { passive: true }
        )
      })()
    </script>
  </body>
</html>
